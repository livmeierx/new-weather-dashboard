const cityNameInput=document.querySelector("#city-name"),searchForm=document.querySelector("#search-form"),currentConditionsUl=document.querySelector("#current-forecast #conditions"),currentConditionsH3=document.querySelector("#current-forecast h3"),previousSearches=document.querySelector("#previous-searches"),previousSearchContainer=document.querySelector("#previous-searches .card-body"),dailyCardContainer=document.querySelector("#daily-forecast"),fiveDayHeader=document.querySelector("#five-day"),localCityArray=[];let previousSearch=JSON.parse(localStorage.getItem("searches"));if(null!==previousSearch)for(let a=0;a<previousSearch.length;a++)null===previousSearch[a]?previousSearch.splice(a,a+1):localCityArray.push(previousSearch[a]);const updateSearchHistory=()=>{previousSearch=JSON.parse(localStorage.getItem("searches"));const a=document.querySelectorAll("#previous-searches button");if(null!==previousSearch){a.forEach(a=>{for(let b=0;b<previousSearch.length;b++)a.dataset.city.includes(previousSearch[b])&&previousSearch.splice(b,b+1)});for(let a=0;a<previousSearch.length;a++){const b=document.createElement("button");b.classList.add("m-2","btn","btn-light"),b.dataset.city=previousSearch[a],b.textContent=previousSearch[a],b.addEventListener("click",a=>{callOpenWeather(a.target.dataset.city)}),previousSearchContainer.appendChild(b)}}},updateLocalStorage=a=>{localCityArray.includes(a)||(localCityArray.push(a),localStorage.setItem("searches",JSON.stringify(localCityArray)),updateSearchHistory())},callOpenWeather=a=>{fetch("https://api.openweathermap.org/data/2.5/weather?q="+a+"&units=imperial&appid=0656324568a33303c80afd015f0c27f8").then(function(a){if(!a.ok){currentConditionsUl.innerHTML="",currentConditionsH3.textContent="Try again!";const a=document.createElement("li");a.textContent="City not found.",currentConditionsUl.appendChild(a),dailyCardContainer.innerHTML="",fiveDayHeader.classList.add("hidden")}else a.json().then(function(a){const b=a.name,c=`https://api.openweathermap.org/data/2.5/onecall?lat=${a.coord.lat}&lon=${a.coord.lon}&exclude=minutely,hourly,alerts&units=imperial&appid=0656324568a33303c80afd015f0c27f8`;fetch(c).then(function(a){a.ok&&a.json().then(function(a){const c="<img src='https://openweathermap.org/img/w/"+a.current.weather[0].icon+".png' alt='Weather icon'>";currentConditionsH3.innerHTML=b+" ("+moment().format("MM/DD/YYYY")+") "+c;const d=[];currentConditionsUl.innerHTML="";for(let b=0;4>b;b++){const a=document.createElement("li");a.classList.add("mb-2"),d.push(a)}d[0].innerHTML="Temperature: "+Math.floor(a.current.temp)+" &deg;F",d[1].textContent="Humidity: "+a.current.humidity+"%",d[2].textContent="Wind Speed: "+Math.floor(a.current.wind_speed)+" MPH";const e=Math.floor(a.current.uvi);d[3].innerHTML=2>=e?`UV Index: <button class="btn btn-info uv">${e}</button>`:2<e&&5>=e?`UV Index: <button class="btn btn-success uv">${e}</button>`:5<e&&8>=e?`UV Index: <button class="btn btn-warning uv">${e}</button>`:`UV Index: <button class="btn btn-danger uv">${e}</button>`,d.forEach(a=>{currentConditionsUl.append(a)});let f=[];dailyCardContainer.innerHTML="";for(let b=0;5>b;b++){const c=document.createElement("div");c.innerHTML=`
                    <div class="p-2 m-2 card bg-info text-white">
                        <h5>${moment().add(b+1,"days").format("MM/DD/YYYY")}</h5>
                        <ul id="conditions">
                            <li><img src='https://openweathermap.org/img/w/${a.daily[b].weather[0].icon}.png' alt="Weather icon" class="mx-auto"></li>
                            <li>Temp: ${Math.floor(a.daily[b].temp.day)} &deg;F</li>
                            <li>Humidity: ${a.daily[b].humidity}%</li>
                        </ul>
                    </div>`,f.push(c)}fiveDayHeader.classList.remove("hidden"),f.forEach(a=>{dailyCardContainer.appendChild(a)}),updateLocalStorage(b)})})})})};searchForm.addEventListener("submit",a=>{a.preventDefault();let b=cityNameInput.value.trim("");""===b?(currentConditionsH3.textContent="Please enter a city!",currentConditionsUl.innerHTML="",dailyCardContainer.innerHTML="",fiveDayHeader.classList.add("hidden")):(callOpenWeather(b),cityNameInput.value="")}),updateSearchHistory(),callOpenWeather("Washington D.C.");
